## 使用 BlueZ 在7688上 Scan BLE 功能與基本常識

本章節待補中，敬請期待。

### 環境準備
- 插上你的7688，並設定好網路
- 檢查 opkg 的更新
``` 
opkg update
```

- 安裝 bluez 所需的 packages，在此我裝了下述的東西
``` 
opkg install 
```

- 再檢查，需要裝什麼其他套件，我們換個作法來裝裝看，利用 openwrt 的 admin界面來找 package。
你可以在登入 7688 時，發現在右上角有一個進入 openwrt 的管理界面處，進入之後會看到左上角會有：
System > Software 點了該標簽後，即可顯示你所安裝的所有套件，並且還可以用來安裝套件喔。
![](openwrt_admin.png)

	- 我們檢查了幾個套件 bluez 相關的都安裝了嗎？
	![](check_bluez.png)

	- dbus 也安裝了嗎? (呼應另一個教學文) 
	![](check_dbus.png)

在安裝了這些套件之後，終於開始要 ssh 到7688上去試試看了。

### 檢查環境
我們首先進入到 /etc/init.d 的目錄中，這個目錄的作用和 linux 是相仿的，就各位自己去學了。
接下來，我們希望 boot 後就可以自動幫我們啟動 bluetooth 相關需要的 deamon，所以我們需要做下述的 2 道指令： 

- Enable 2個服務, 設定自動啟動
```
/etc/init.d/ enable
```
![](螢幕快照 2015-09-03 下午3.01.14.png)

- 直接現在就啟動它們
```
/etc/init.d/ enable
```

![](螢幕快照 2015-09-03 下午3.01.14.png)




### 測試環境
在 7688 上我們有一個 USB，如果你是大頭轉成小的頭，記得要用 OTG 的。我用普通的沒有成功，但是如果你有買7688的擴充版，那個上頭大的 USB 是可以直接插入 USB devides 就可以使用的。我們檢查可以下這個指令：
```
lsusb 
```

可以查看，是否有任何 USB device 被偵測到。在此，我們的例子成功的看到了下述畫面： 
![](lsusb_result.png)

我們可以看到，第 2 行顯示他抓到了一個我安裝上去的 devices，一看名字就知道是個 bluetooth 的東西。（為什麼？不要問，很可怕的）
 
### Bluetooth 測試 1
接下來，我們來試試，環境都好了，先來假裝自己是個 BLE 元件，然後我們開一個 App 看看是否可以找到它。在這裡我們使用 iOS 上的 lightBlue 來作測試。我們執行下述指令：
```
hi
```

接著在 App 中重新 scan 附近的 bluetooth 裝置。看到我們找到了一個叫 BlueZ 5.30 的裝置， 就是成功的找到了。
![](螢幕快照 2015-09-03 下午3.01.14.png)

### Bluetooth 測試 2
有時我們會希望去測別台藍芽裝置是否在，所以我們要 scan 一下周圍。在這裡我們可以利用指令： 
``` 
hitool scan
```

這樣子我們便可以等待一下子，得到我先前在周圍先開啟的 BLE 裝置。
![](螢幕快照 2015-09-03 下午3.01.14.png)
![](螢幕快照 2015-09-03 下午3.01.14.png)

### 撰寫啟動和關閉的腳本 (Script)
因為每次要啟動設定很累，所以我們參照了別的布落格，同樣的作了3個設定檔，以便我們每次執行方便。
我們這裡寫了 ble.conf，start.sh 和 stop.sh。都是和 linux 相同的內容，所以細節就要自己去查詢了。

- ble.conf
```
```

- start.sh
```
```

- stop.sh
```
```

### 結論 (Conclusion) 
我拖一下稿... 好累。

### 參考資料 (Reference)
* https://wiki.openwrt.org/doc/howto/usb.bluetooth
